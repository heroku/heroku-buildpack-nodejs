name: CI

on:
  push:
    branches: ["main"]
  pull_request:

permissions:
  contents: read

env:
  HEROKU_API_KEY: xxxxxxx
  HEROKU_API_USER: xxxxxxx

jobs:
  unit-test:
    runs-on: ubuntu-22.04
    container:
      image: heroku/heroku:${{ matrix.stack_number }}-build
    strategy:
      matrix:
        stack_number: ["18", "20", "22"]
    steps:
      - uses: actions/checkout@v2
      - name: Run unit tests
        run: test/unit

  unit-test-heroku-build:
    runs-on: ubuntu-22.04
    container:
      image: heroku/heroku:${{ matrix.stack_number }}-build
    strategy:
      matrix:
        stack_number: ["18", "20", "22"]
    steps:
    - uses: actions/checkout@v2
    - name: Test heroku-${{ env.stack-number }}-build
      run: test/run

  hatchet-test:
    runs-on: sfdc-hk-ubuntu-latest
    container:
      image: ruby:2.7.2
    steps:
    - uses: actions/checkout@v2
    - name: Run hatchet tests
      run: make hatchet

  unit-test-binary:
    runs-on: sfdc-hk-ubuntu-latest
    container:
      image: golang:1.14
    steps:
    - uses: actions/checkout@v2
#     # 'setup_remote_docker' was not transformed because there is no suitable equivalent in GitHub Actions
    - name: Test Go Binary
      run: make test-binary
